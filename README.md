# ๐ฟ๏ธ ูุธุงู ุฐูู ูุฅุฏุงุฑุฉ ููุงูู ุงูุณูุงุฑุงุช (ููู ุนุฑุถ ูููุงูุดุฉ)

ูุฐุง ุงูููู ุฌุงูุฒ ููููุงูุดุฉ ูุงูุนุฑุถ: ููุฏู ููุฎุตูุง ุชูููุฐููุงุ ุฎุทูุงุช ุงูุชุดุบูู ุงูุณุฑูุนุ ุงููุนูุงุฑูุฉุ ุชุฏูู ุงููุนุงูุฌุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ุฃูู ูุงุฌูุงุช ุงููAPIุ ูุณููุงุฑูู ุนุฑุถ ุญู ูุน ุฃุณุฆูุฉ ูุฃุฌูุจุฉ ุดุงุฆุนุฉ.

## ๐ฏ ุงูููุฎุต ุงูุชูููุฐู

- ุงููุดููุฉ: ูุชุงุจุนุฉ ุฅุดุบุงู ุฃูุงูู ุงูุงูุชุธุงุฑ ูุฏูููุง ูุณุจุจ ุงุฒุฏุญุงููุง ูุฅูุฏุงุฑูุง ููููุช.
- ุงูุญู: ุฎุฏูุฉ ุฎูููุฉ ุชุนุชูุฏ ุนูู ุฑุคูุฉ ุญุงุณูุจูุฉ ุชุฑุตุฏ ุงูุณูุงุฑุงุช ูุชุญุฏุฏ ุงูุฃูุงูู ุงููุดุบููุฉ/ุงููุชุงุญุฉ ุขูููุง.
- ุงููููุฉ: ูุฑุงุฑ ุฃุณุฑุน ูููุณุชุฎุฏูุ ุฅุญุตุงุกุงุช ุชุดุบูููุฉุ ููุงุจููุฉ ุฏูุฌ ูุน ุชุทุจููุงุช ูุงุฌูุฉ ุฃูุงููุฉ ูููุญุงุช ูุนูููุงุช.

## ๐๏ธ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู

```
โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
โ  ูุงุฌูุฉ ุฃูุงููุฉ โ โโ โ  REST API (Node) โ โโ โ  ูููุฐุฌ ONNX (YOLO)โ
โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
                               โ
                               โผ
                        โโโโโโโโโโโโโโโโโโโโ
                        โ   PostgreSQL     โ
                        โโโโโโโโโโโโโโโโโโโโ
```

- ููุทุฉ ุงูุฏุฎูู: [server.js](file:///d:/AI-based-Parking-Management-System/server.js)
- ุชููุฆุฉ ุงูุชุทุจูู ูุงููุณุงุฑุงุช: [app.js](file:///d:/AI-based-Parking-Management-System/src/app.js)
- ููุทู ุงูุฐูุงุก ุงูุงุตุทูุงุนู: [modelController.js](file:///d:/AI-based-Parking-Management-System/src/controllers/modelController.js)
- ุฎุฏูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช: [parkingService.js](file:///d:/AI-based-Parking-Management-System/src/services/parkingService.js)
- ุชุนุฑูู ุงูุฌุฏุงูู ูุงูุจูุงูุงุช ุงูุฃูููุฉ: [database-setup.sql](file:///d:/AI-based-Parking-Management-System/database-setup.sql)

## ๐๏ธ ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

- Node.js (ES Modules) + Express 5
- PostgreSQL ุนุจุฑ pg Pool
- ONNX Runtime Node ููููุฐุฌ YOLO
- Jimp ููุนุงูุฌุฉ ุงูุตูุฑ ูLetterbox ุฅูู 640ร640
- Multer ูุฑูุน ุงููููุงุช
- JWT + bcrypt ูููุตุงุฏูุฉ ูุงูุฃูุงู

## โ๏ธ ุงูุชุดุบูู ุงูุณุฑูุน (Quick Start)

1) ุชุซุจูุช ุงูุงุนุชูุงุฏุงุช:
```bash
npm install
```
2) ุฅุนุฏุงุฏ ููู ุงูุจูุฆุฉ `.env`:
```env
PORT=3000
DATABASE_URL=postgresql://username:password@localhost:5432/smart_parking
JWT_SECRET=change_me
RUN_DB_SETUP=false
```
3) ุชุฌููุฒ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุฑุฉ ูุงุญุฏุฉ):
```bash
npm run setup-db
```
4) ุชุดุบูู ุงูุฎุงุฏู:
```bash
npm run dev   # ูุถุน ุงูุชุทููุฑ
# ุฃู
npm start     # ูุถุน ุงูุฅูุชุงุฌ
```

ูุตูุญุฉ ููุนุฑุถ: ุงุฌุนู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ูููู `best.onnx` ููุฌูุฏ ูู ุฌุฐุฑ ุงููุดุฑูุน.

## ๐ง ููู ูุนูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู

- ุชูุฌุฑู Letterbox ููุตูุฑุฉ ุฅูู 640ร640 ูุน ุญูุธ ุงููุณุจุฉ.
- ูุจูู ุงููุชุญูู Tensor ุดูู [1,3,640,640] ููุดุบู ุฌูุณุฉ ONNX ููุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุงูุฅููุงุน.
- ูุฑุดูุญ ุงููุงุฆูุงุช ุฅูู ุงูุณูุงุฑุงุช ููุท ูุจุซูุฉ โฅ 0.25.
- ูุญููู ุฅุญุฏุงุซูุงุช ุงูุตูุฏูู ุฅูู ุฃุจุนุงุฏ ุงูุตูุฑุฉ ุงูุฃุตููุฉ.
- ููุฑุฑ ุฅุดุบุงู ุงูููุงู ุนุจุฑ ุชูุงุทุน ุงููุณุงุญุฉ ูุน ุตูุฏูู ูู ูููู:
  - ุฅุฐุง ุชุฌุงูุฒ ุงูุชูุงุทุน 50% โ ูุดุบูู.
  - ุฅุฐุง ูุงู ุฃูู ูู 35% โ ุบูุฑ ูุดุบูู.
  - ุงูููุทูุฉ ุงูุฑูุงุฏูุฉ ุชูุญุณู ุจูุฑูุฒ ุตูุฏูู ุงููุดู ุฏุงุฎู ุงููุฑุจุน.

ุฑุงุฌุน ุงูุฎูุงุฑุฒููุฉ ูู: [modelController.js](file:///d:/AI-based-Parking-Management-System/src/controllers/modelController.js#L26-L55)

## ๐ ูุงุฌูุงุช ุงููAPI ุงูุฃุณุงุณูุฉ

- ุงููุตุงุฏูุฉ [auth.js](file:///d:/AI-based-Parking-Management-System/src/routes/auth.js)
  - POST /api/auth/register
  - POST /api/auth/confirm_register  (ุงุณุชูุงู ููุฏ ุชุญูู ูุณุฌูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุบุฑุถ ุงูุงุฎุชุจุงุฑ)
  - POST /api/auth/login
  - POST /api/auth/logout
  - POST /api/auth/forget_password
  - POST /api/auth/confirm_forget_password
  - POST /api/auth/reset_password

- ุงููููุฐุฌ [model.js](file:///d:/AI-based-Parking-Management-System/src/routes/model.js)
  - POST /api/model/process  (multipart/form-data: file + ุงุฎุชูุงุฑู parking_id)
  - POST /api/model/latest   (ูุชุทูุจ JWT) ูุนูุฏ ุขุฎุฑ ูุชูุฌุฉ ูููุดู + ุงูุชุฎุทูุท ุฅู ูุฌุฏ

- ุงููุณุชุฎุฏู [user.js](file:///d:/AI-based-Parking-Management-System/src/routes/user.js) (ูุชุทูุจ JWT)
  - POST /api/user/favourite     ุฅุถุงูุฉ ูููู ููุถู
  - GET  /api/user/favourites    ุฌููุน ุงูููุถูุงุช
  - GET  /api/user/history       ุขุฎุฑ ุฃูุงูู ุชูุช ุฒูุงุฑุชูุง

ุฃูุซูุฉ ูุฎุชุตุฑุฉ:
```bash
# ุชุณุฌูู ูุณุชุฎุฏู
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"name":"User","email":"u@example.com","phone":"010","password":"pass"}'

# ุชุฃููุฏ ุงูุชุณุฌูู (ุงูููุฏ ูุนูุฏ ูู ุงูุงุณุชุฌุงุจุฉ ุฃุซูุงุก ุงูุชุทููุฑ)
curl -X POST http://localhost:3000/api/auth/confirm_register \
  -H "Content-Type: application/json" \
  -d '{"email":"u@example.com","code":"123456"}'

# ุชุณุฌูู ุงูุฏุฎูู
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"u@example.com","password":"pass"}'

# ูุนุงูุฌุฉ ุตูุฑุฉ ูููู (ูููุถูู ุชูุฑูุฑ parking_id)
curl -X POST http://localhost:3000/api/model/process \
  -F "file=@parking.jpg" \
  -F "parking_id=1"

# ุขุฎุฑ ูุชูุฌุฉ ูููุดู (ูุชุทูุจ ุชููู)
curl -X POST http://localhost:3000/api/model/latest \
  -H "Authorization: Bearer <TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{"parking_id":1}'
```

## ๐๏ธ ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช

ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ:
- users, email_verifications, password_resets, token_blacklist
- parking_lots, parking_slots, detection_logs
- parking_detection_results, parking_layouts
- favourite_parkings, parking_history

ุงูุชุนุฑูู ุงููุงูู: [database-setup.sql](file:///d:/AI-based-Parking-Management-System/database-setup.sql)

## ๐ฆ ุณูุฑูุจุชุงุช ูุณุงุนุฏุฉ

- ุฅุนุฏุงุฏ ุงููุงุนุฏุฉ: `npm run setup-db` โ [setup-database.js](file:///d:/AI-based-Parking-Management-System/setup-database.js)
- ุงุณุชูุฑุงุฏ ูุฎุทุท ููุงูู (layout) ูุฑูู ูููู ูุนูู:
```bash
node scripts/import_parking2_layout_if_missing.js parking2_layout.json
```
- ุงุณุชูุฑุงุฏ ุตูุงุฏูู ุงูููุงูู (slots) ููู parkingId=2:
```bash
node scripts/import_parking2_slots_if_missing.js boxes_converted.json
# ูุฅุฌุจุงุฑ ุงูุชุญุฏูุซ:
node scripts/import_parking2_slots_if_missing.js boxes_converted.json --force
```

## ๐งช ุณููุงุฑูู ุนุฑุถ ุญู (Demo Script)

- ุชุฌููุฒ: ุชุดุบูู Postgresุ ูุถุน `.env`ุ `npm run setup-db`ุ ุชุดุบูู `npm run dev`.
- ุชุณุฌูู ูุณุชุฎุฏูุ ุชุฃููุฏูุ ุซู ุชุณุฌูู ุงูุฏุฎูู ูุฃุฎุฐ ุงูุชููู.
- ุฑูุน ุตูุฑุฉ ุฅูู `/api/model/process` ูุน `parking_id=1` ูุงุณุชุนุฑุงุถ ูุชูุฌุฉ ุงูุฃูุงูู ุงููุดุบููุฉ ูุงููุชุงุญุฉ.
- ุงุณุชุฏุนุงุก `/api/model/latest` ุจููุณ `parking_id` ูุฅุจุฑุงุฒ ุญูุธ ุงููุชุงุฆุฌ ูุงูุชุฎุทูุท.
- ุฅุจุฑุงุฒ ุฌุฏุงูู ุงููุงุนุฏุฉ (history/favourites) ุจุฅุถุงูุฉ ูููู ููุถู ุซู ุนุฑุถ ุงููุงุฆูุฉ.

ููุทุฉ ููุฉ: ุชุญููู ูููุฐุฌ ONNX ูุฑุฉ ูุงุญุฏุฉ ุนูุฏ ุงูุฅููุงุน ูุชูููู ุฒูู ุงูุงุณุชุฌุงุจุฉ.

## ๐ ุงูุฃูุงู

- ุชุฌุฒุฆุฉ ูููุงุช ุงููุฑูุฑ ุนุจุฑ bcrypt.
- JWT ูุน ุตูุงุญูุฉ ููุดู ุงูุชูุงุก ูุชุญูู ูู ูุงุฆูุฉ ุณูุฏุงุก ุนูุฏ ุงูุฎุฑูุฌ.
- ุงูุชุญูู ูู ุงูุชููู ูู ูุณุงุฑุงุช ุงููุณุชุฎุฏู ููุชุงุฆุฌ ุงููููุฐุฌ.
- ุญุธุฑ ุฑูุน ุงููููุงุช ุฅูุง ููุฌูุฏ `uploads/` ูุงูุชุญูู ุงูุฃุณุงุณู ูู ุงููุฏุฎูุงุช.

## โก๏ธ ุงูุฃุฏุงุก

- ูุนุงูุฌุฉ ุงูุตูุฑุฉ ุนุจุฑ Jimp ูLetterbox ูุชูููู ุงูุชูููุฉ ุงูุญุณุงุจูุฉ.
- Pool ููุงุชุตุงูุงุช ุจูุงุนุฏุฉ ุงูุจูุงูุงุช.
- ุญูุธ ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุจูุงูุงุช ุงููุทููุจุฉ ูู ุงูุณุฌูุงุช.

## โ๏ธ ุงููููุฏ ุงููุนุฑููุฉ

- ุงูุงุนุชูุงุฏ ุนูู ุตูุฑ ุซุงุจุชุฉ (ูุง ูุนุงูุฌุฉ ููุฏูู ููุชโุญูููู ุญุชู ุงูุขู).
- ุญุณุงุณูุฉ ุงูุฏูุฉ ูุฌูุฏุฉ ุงูุตูุฑุฉ ูุฒุงููุฉ ุงูุงูุชูุงุท.
- ุชุฎุทูุท ุงูููุงูู ุซุงุจุช ููุญุชุงุฌ ุฅูู ุชููุฆุฉ ูุณุจูุฉ ููู ูููู.

## ๐ฎ ุฃุนูุงู ูุณุชูุจููุฉ

- ุฏุนู ุงูุจุซ ุงูุญู ููููุฏูู.
- ุชุนุฏุฏ ุณุงุญุงุช ุงูุงูุชุธุงุฑ ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุฃุฏูุงุฑ.
- ููุญุฉ ููุงุณ ุฅุญุตุงุฆูุฉ ูุชูุงูู ูุน ุชุทุจูู ุฌูุงู.
- ุชูุจููุงุช ูุฅุดุนุงุฑุงุช ูููุฒุฉ ุงูุญุฌุฒ.

## ๐๏ธ ูููู ุงููุดุฑูุน

```
AI-based-Parking-Management-System/
โโ best.onnx
โโ server.js
โโ src/
โ  โโ app.js
โ  โโ db.js
โ  โโ controllers/
โ  โ  โโ authController.js
โ  โ  โโ modelController.js
โ  โ  โโ userController.js
โ  โโ routes/
โ  โ  โโ auth.js
โ  โ  โโ model.js
โ  โ  โโ user.js
โ  โโ services/
โ     โโ parkingService.js
โโ scripts/
โ  โโ import_parking2_layout_if_missing.js
โ  โโ import_parking2_slots_if_missing.js
โ  โโ save_parking_layout.js
โโ database-setup.sql
```

## ๐ ุงูุชุฑุฎูุต

ISC License.
